<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel='stylesheet' href='../public/css/main.css' >
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
    crossorigin="anonymous" />
  <!-- <script src="js/jquery-3.5.1.min.js"></script> -->
  <!-- <script src="js/multislider.min.js"></script> -->

  <link rel='stylesheet' href='../public/css/offer.css' >

  <title>Entrepôt</title>
</head>

<body>
  <!--Navbar-->
  <nav>
    <!--Navbar has two part the top one and the bottom one-->
    <!--Here is top one and in this part I put logo, my account part, and the shopping cart-->
    <div class="navbar-top">
      <!-- <img class="logo-image" src="img/logo.JPG" /> -->
      <div>
        <h2 class="logo">Entrepôt</h2>

        <button id="menuButton"><i class="fas fa-bars"></i></button>
        <!--Logo-->
      </div>
      <div>
        <div class="account">
          <a href="homepage.html"> </a>
            <button class="account-btn">
              <i class="fas fa-user-alt"></i>
            </button>
            <span class="account-text">My account</span>
         
          <!--When we click the btnShowAccountInfo this section will be displayed-->
        </div>
      </div>
    </div>
    <!-- Navbar bottom part -->
    <!-- Here I put the links to the other pages or nav links -->
    <div class="navbar" id="navbar">
      <div class="links">
        <ul>
          <li class="nav-links">
            <a href="homepage.html" class="link">Homepage</a>
          </li>
          <li class="nav-links">
            <a href="product_listing.html" class="link">Product Listing</a>
          </li>
          <li class="nav-links">
            <a href="product_details.html" class="link">Product Details</a>
          </li>
          <li class="nav-links">
            <a href="product_registration.html" class="link">Product Registration</a>
          </li>
          <li class="nav-links">
            <a href="product_management.html" class="link">Product Management</a>
          </li>
          <li class="nav-links">
            <a href="rating_feedback.html" class="link">Rating and Feedback</a>
          </li>
          <li class="nav-links">
            <a href="offer_registration.html" class="link">Offer Registration</a>
          </li>
          <li class="nav-links">
            <a href="offer_management.html" class="link">Offer Management</a>
          </li>
          <li class="nav-links">
            <a href="deal_history.html" class="link">Deal History</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  

  <main>
    <!-- <div class="alertMessage" id="errorBox">
      <span class="close" onclick="this.parentElement.style.display='none';">×</span>
      
    </div> -->
    <div class="panel-back">
        
            <section class="panel">
                <h1> Create a new offer</h1>
                <label   class = "inputTitle">
                        Desired PostId	
                </label>
                
                <form enctype="multipart/form-data" id="file_upload">
                <!-- <form method="post" action="/offers" enctype="multipart/form-data" id="file_upload"> -->
        
                    <p id="postId" >67891012aed</p>
                    <p id="senderId" hidden>buyer</p>
                    <br>
                    <label for="offerItem"  class = "inputTitle">
                        Offer Item Name	
                    </label><br>
                    <input type="text" name="offerItem" id="offerItem" maxlength="30" class="createInputName" placeholder="Offer Item Name">
                    <br>
                    <br>
            
                    <label for="itemDesc"  class = "inputTitle">
                      Degree of wear	
                    </label><br>
                    <select class="createInputWear" id = "wear">
                      <option value="10">Like new</option>
                      <option value="8">Good condition</option>
                      <option value="6">Fair condition</option>
                      <option value="4">Poor condition</option>
                      <option value="2">Need repair</option>
                      <option value="0">Sold as component</option>
                    </select>
                     
                    <br>
                    <br>

                    <label for="itemDesc"  class = "inputTitle">
                        Offer Item Description	
                    </label><br>
                    <textarea  name="itemDesc" id="itemDesc"  maxlength="200" class="createInputDesc"></textarea>
                    <br>
                    <br>
        

        
                    <p>
                    <label for="file" class="uploadImgButton">Upload Image</label>
                    <input type="file" id="file" name="upload_image" accept="image/gif, image/jpeg, image/png, image/jpg" hidden>
                    <!-- <p>Preview</p> -->
                    <!--<img id="image-preview" class="createOfferImg">-->
                    <p id="info"></p>
                    <br>
                    
                    <input type="button" value="SUBMIT" id="submit" class="createOfferButton"/>
                    <!--</p>-->
                    
                </form>
        
            </section>
        
    </div>
    
    

    <div id="div5" hidden>111</div>
  </main>
  <footer>
    <div class="footer-second">
      <div class="footer-column-2">
        <h3>Customer service</h3>
        <a href="#">Contact</a>
        <a href="#">Track your order</a>
      </div>
      <div class="footer-column-3">
        <h3>About us</h3>
        <a href="#">Who we are</a>
        <a href="#">Our Services</a>
      </div>
    </div>
    <ul class="footer-last">
      <li>
        <p><i class="fab fa-cc-mastercard"></i></p>
      </li>
      <li>
        <p><i class="fab fa-cc-paypal"></i></p>
      </li>
      <li>
        <p><i class="fab fa-cc-visa"></i></p>
      </li>
      <li>
        <p><i class="fab fa-cc-amex"></i></p>
      </li>
    </ul>
  </footer>

  
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
		crossorigin="anonymous"></script>

  <script type="text/javascript">
        
  let fileInput = document.getElementById('file');
  let info = document.getElementById('info');
  let preview = document.getElementById('image-preview');
  // 监听change事件:
  fileInput.addEventListener('change', function() {
      // 清除背景图片:
      preview.style.backgroundImage = '';
      if (!fileInput.value) {
          info.innerHTML = '没有选择文件';
          return;
      }
      let file = fileInput.files[0];
      let size = file.size;
      if (size >= 1 * 1024 * 1024) {
          alert('文件大小超出限制');
          info.innerHTML = '文件大小超出限制';
          return false;
      }
      // 获取File信息:
      // info.innerHTML = `文件名称:  + ${file.name}<br>文件大小: ${file.size} <br>上传时间: ${file.lastModifiedDate}`;
      info.innerHTML = `Image Size: ${file.size/1024}`;
      if (!['image/jpeg', 'image/png', 'image/gif'].includes(file.type)) {
          alert('不是有效的图片文件!');
          return;
      }
      // 读取文件:
      let reader = new FileReader();
      reader.onload = function(e) {
          let data = e.target.result;
          console.log(preview, 'a标签')
          preview.src = data
      };
      // 以DataURL的形式读取文件:
      reader.readAsDataURL(file);

  });

  // let params = {};
  let params = new FormData();
  let submit = document.getElementById("submit");
  submit.onclick = function() {
    params.append("upload_image",document.getElementById("file").files[0])
    params.append("senderId", document.getElementById("senderId").innerHTML);
    params.append("postId", document.getElementById("postId").innerHTML);
    params.append("sellerId", "seller");
    params.append("offerItem", document.getElementById("offerItem").value);
    params.append("itemDesc", document.getElementById("itemDesc").value);
    params.append("wear", document.getElementById("wear").value);
    // params = {
    //   postId: document.getElementById("postId").innerHTML,
    //   senderId: document.getElementById("senderId").innerHTML,
    //   sellerId: "seller",
    //   upload_image: document.getElementById("file").files[0],
    //   offerItem: document.getElementById("offerItem").value,
    //   itemDesc: document.getElementById("itemDesc").value,
    //   wear: document.getElementById("wear").value

    // }

    // alert(params);
    // console.log(params.get("upload_image"));
    // console.log(params.get("senderId"))
    
    $.ajax({
    url: '/offers',
    data: params,
    cache: false,
    // contentType: 'multipart/form-data',
    contentType: false, // NEEDED, DON'T OMIT THIS (requires jQuery 1.6+)
    processData: false,
    type: 'POST',
    success: function(data){
      document.location.href = "/";
    }
});

};
  
  </script>

</body>

</html>